{% load static %}

<solve-problem x-data="{ modalOpen: false }">
    {% if user.is_authenticated %}
        <button id="problemSolve{{ problem.id }}"
                class="htmx-fade-in htmx-fade-out"
                @click="modalOpen = true"
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 scale-90"
                x-transition:enter-end="opacity-100 scale-100"
                x-transition:leave="transition ease-in duration-300"
                x-transition:leave-start="opacity-100 scale-100"
                x-transition:leave-end="opacity-0 scale-90"
        >{{ icon_solve|safe }}</button>
        <modal class="fixed inset-0 px-2 z-[999] overflow-hidden flex items-center justify-center"
             x-show="modalOpen">
            <modal-overlayer class="absolute inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                x-cloak x-show="modalOpen"
                x-transition:enter="transition ease-out duration-300 transform"
                x-transition:enter-start="opacity-0"
                x-transition:enter-end="opacity-100"
                x-transition:leave="transition ease-in duration-200 transform"
                x-transition:leave-start="opacity-100"
                x-transition:leave-end="opacity-0"
            ></modal-overlayer>
            <modal-content class="bg-white rounded-md shadow-xl overflow-hidden max-w-md w-full sm:w-96 md:w-1/2 lg:w-2/3 xl:w-1/3 z-50"
                x-cloak x-show="modalOpen" @click.away="modalOpen = false"
                x-transition:enter="transition ease-out duration-300 transform"
                x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                x-transition:leave="transition ease-in duration-200 transform"
                x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
            >
                <modal-header class="flex flex-col items-center justify-center p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                    <h2 class="text-xl font-semibold m-0 text-green-700 dark:text-white">
                        문제 정답을 선택해주세요.
                    </h2>
                    <a class="font-bold text-gray-500 hover:underline"
                       href="{{ problem.get_absolute_url }}">
                        {{ problem.full_reference }}
                    </a>
                </modal-header>
                <modal-body class="p-4 text-center text-base">
                    <form type="button" hx-target="#solveResult" hx-swap="innerHTML swap:0.25s">
                        <fieldset class="flex gap-1 justify-center">
                            {% for i in '1234' %}
                                <label class="solve_button" for="answer{{ problem.id }}-{{ i }}">
                                    {{ i }}
                                    <input id="answer{{ problem.id }}-{{ i }}" class="hidden"
                                           type="radio" name="answer" value="{{ i }}"
                                           hx-post="{{ problem.get_solve_url }}">
                                </label>
                            {% endfor %}
                            {% if problem.sub != '헌법' %}
                                <label class="solve_button" for="answer{{ problem.id }}-5">
                                    5
                                    <input id="answer{{ problem.id }}-5" class="hidden"
                                           type="radio" name="answer" value="5"
                                           hx-post="{{ problem.get_solve_url }}">
                                </label>
                            {% endif %}
                        </fieldset>
                    </form>
                    <div id="solveResult" class="pt-4 text-center text-lg font-bold htmx-fade-in htmx-fade-out"></div>
                </modal-body>
            </modal-content>
        </modal>
    {% else %}
        <a href="{% url 'account_login' %}">
            {{ icon_solve|safe }}
        </a>
    {% endif %}
</solve-problem>

{% partialdef result %}
    {% if is_correct %}
        <span class="text-green-400">정답입니다.</span>
    {% else %}
        <span class="text-red-700">오답입니다. 다시 풀어보세요.</span>
    {% endif %}

    <button id="problemSolve{{ problem.id }}" hx-swap-oob="innerHTML">
        {{ icon_solve|safe }}
    </button>
{% endpartialdef result %}
